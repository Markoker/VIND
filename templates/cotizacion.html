<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizacion</title>
</head>
<body>
    <h1>Cotización</h1>
    <p>Cantidad de estudiantes: {{cantidad}}</p>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        {{ form.as_p }}

        <!-- Datos de traslado -->
        <div id="traslado-fields" style="display:none;">
            <h2>Datos de Traslado</h2>
            <p>Nombre del proveedor de traslado: <input type="text" name="nombre_proveedor_traslado"></p>
            <p>RUT del proveedor de traslado: <input type="text" name="rut_proveedor_traslado"></p>
            <p>Correo del proveedor de traslado: <input type="email" name="correo_proveedor_traslado"></p>
            <p>Monto total de traslado: <input type="number" name="monto_traslado" id="id_monto_traslado"></p>
            <p>Cotización 1 de traslado: <input type="file" name="cotizacion_1_traslado"></p>
            <p style="display:none;">Cotización 2 de traslado: <input type="file" name="cotizacion_2_traslado"></p>
            <p style="display:none;">Cotización 3 de traslado: <input type="file" name="cotizacion_3_traslado"></p>
        </div>

        <!-- Datos de colación -->
        <div id="colacion-fields" style="display:none;">
            <h2>Datos de Colación</h2>
            <p>Nombre del proveedor de colación: <input type="text" name="nombre_proveedor_colacion"></p>
            <p>RUT del proveedor de colación: <input type="text" name="rut_proveedor_colacion"></p>
            <p>Correo del proveedor de colación: <input type="email" name="correo_proveedor_colacion"></p>
            <p>Monto individual de colación: <input type="number" name="monto_individual" id="id_monto_individual"></p>
            <p>Tipo de subvención: 
                <select name="tipo_subvencion" id="id_tipo_subvencion">
                    <option value="">Seleccione una opción</option>
                    <option value="reembolso">Reembolso</option>
                    <option value="presupuesto">Previa presupuestación</option>
                </select>
            </p>
            <p>Cotización 1 de colación: <input type="file" name="cotizacion_1_colacion"></p>
            <p style="display:none;">Cotización 2 de colación: <input type="file" name="cotizacion_2_colacion"></p>
            <p style="display:none;">Cotización 3 de colación: <input type="file" name="cotizacion_3_colacion"></p>
        </div>

        <!-- Instructivo para reembolso -->
        <p id="instructivo-presupuestacion" style="display:none;">
            Complete el siguiente archivo: <a href="/path/to/archivo">archivo a completar</a>. 
            Luego adjunte las boletas de compra y envíe al siguiente correo: 
            <a href="mailto:correo@example.com">correo@example.com</a>.
        </p>

        <button type="submit">Enviar</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tipoField = document.getElementById('id_tipo');
            const montoTrasladoField = document.getElementById('id_monto_traslado');
            const montoIndividualField = document.getElementById('id_monto_individual');
            const tipoSubvencionField = document.getElementById('id_tipo_subvencion');
            const instructivoPresupuestacion = document.getElementById('instructivo-presupuestacion');

            const trasladoFields = document.querySelectorAll('[name="cotizacion_2_traslado"], [name="cotizacion_3_traslado"]');
            const colacionFields = document.querySelectorAll('[name="cotizacion_2_colacion"], [name="cotizacion_3_colacion"]');

            function toggleFields() {
                const tipo = tipoField.value;
                const montoTraslado = parseFloat(montoTrasladoField.value) || 0;
                const montoIndividual = parseFloat(montoIndividualField.value) || 0;

                // Mostrar campos adicionales de traslado si el monto excede 1,000,000
                const showAdditionalTraslado = tipo === 'Solo traslado' && montoTraslado > 1000000;
                trasladoFields.forEach(field => field.closest('p').style.display = showAdditionalTraslado ? '' : 'none');

                // Mostrar campos adicionales de colación si el monto individual excede 6,000
                const showAdditionalColacion = (tipo === 'Solo colacion' || tipo === 'Traslado y colacion') && montoIndividual > 6000;
                colacionFields.forEach(field => field.closest('p').style.display = showAdditionalColacion ? '' : 'none');

                // Mostrar instructivo solo si tipo de subvención es reembolso
                instructivoPresupuestacion.style.display = tipoSubvencionField.value === 'reembolso' ? '' : 'none';
            }

            tipoField.addEventListener('change', toggleFields);
            montoTrasladoField.addEventListener('input', toggleFields);
            montoIndividualField.addEventListener('input', toggleFields);
            tipoSubvencionField.addEventListener('change', toggleFields);

            toggleFields();  // Inicializar visualización
        });
    </script>
</body>
</html>